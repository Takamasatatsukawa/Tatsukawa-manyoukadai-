<div class="container">
  <div class="row">
    <div class="col">
    <h1><%= t("activerecord.attributes.task.tasks index") %></h1>
    </div>
  </div>

<%= form_with url: tasks_path, method: :get, local: true, scope: :search do |form| %>
  <div class="row">
    <div class="col-md-3">
      <%= form.label :status, 'ステータス' %>
      <%= form.select :status, options_for_select(Task.statuses.keys.map { |status| [status.humanize, status] }, selected: @search_params[:status]), include_blank: true %>
    </div>
    <div class="col-md-3">
      <%= form.label :title, 'タイトル' %>
      <%= form.text_field :title, value: @search_params[:title] %>
    </div>
    <div class="col-md-3">
      <%= form.label :label_id, '検索' %>
      <%= form.select :label, options_for_select(@labels.map { |label| [label.name, label.id] }, selected: @search_params[:label_id]), include_blank: true %>
    </div>
    </div>
    <div class="col-md-3 d-flex align-items-end">
      <div class="col text-right">
      <%= form.submit '検索', id: 'search_task', class: 'btn btn-primary w-100' %>
      </div>
    </div>
<% end %>

<table class="table mt-3">
  <thead>
    <tr>
    <th><%= link_to t("activerecord.attributes.task.title"), tasks_path %></th>
    <th><%= link_to t("activerecord.attributes.task.content"), tasks_path %></th>
    <th><%= link_to t("activerecord.attributes.task.created_at"), tasks_path %></th>
    <th><%= link_to t("activerecord.attributes.task.deadline_on"), tasks_path(sort_deadline_on: true) %></th>
    <th><%= link_to t("activerecord.attributes.task.priority"), tasks_path(sort_by: 'priority') %></th>
    <th><%= t("activerecord.attributes.task.status") %></th>
   <th>Actions</th>
    </tr>
  </thead>
  <tbody>
   <% @tasks.each do |task| %>
    <tr class="task"> 
        <td class="task_title"><%= task.title %></td>
        <td><%= task.content %></td>
        <td><%= task.created_at_in_time_zone.strftime('%Y/-%m/-%d %H:%M:%S %Z') %></td>
        <td><%= task.deadline_on %></td>
        <td><%= I18n.t("enums.task.priority.#{task.priority}") %></td>
        <td><%= I18n.t("enums.task.status.#{task.status}") %></td>
        <td>
          <%= link_to t("activerecord.attributes.task.show"), task_path(task), class: 'show-task btn btn-primary' %>
          <%= link_to t("activerecord.attributes.task.edit"), edit_task_path(task), class: 'edit-task btn btn-primary' %>
          <%= link_to t("activerecord.attributes.task.destroy"), task_path(task), method: :delete, data: { confirm: t("activerecord.attributes.task.confirm_delete") }, class: 'destroy-task btn btn-danger' %>
        </td>
    </tr>
   <% end %>
  </tbody>
</table>

<%= paginate @tasks %>
</div>